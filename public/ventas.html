<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Ventas | Toy Garage</title>
    <link rel="stylesheet" href="css/ventas.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Racing+Sans+One&display=swap"
        rel="stylesheet">
</head>

<body>
    <header>
        <div class="header-top">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-car"></i>
                </div>
                <div class="logo-text">
                    <h1>Toy Garage</h1>
                    <h2>Collector Corner - Panel de Ventas</h2>
                </div>
            </div>

            <div class="user-info">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-details">
                    <div class="user-name" id="userName">Usuario</div>
                    <div class="user-role" id="userRole">Rol</div>
                </div>
                <button id="logoutBtn" class="logout-btn">Cerrar Sesión</button>
            </div>
        </div>

        <nav>
            <ul>
                <li><a href="calendario.html"><i class="fas fa-calendar-alt"></i> Calendario</a></li>
                <li><a href="cancelaciones.html"><i class="fas fa-chart-line"></i> Administrar</a></li>
                <li><a href="settings.html"><i class="fas fa-cog"></i> Configuración</a></li>
            </ul>
        </nav>
    </header>

    <main class="ventas-container">
        <div class="fecha-actual" id="fecha-actual"></div>

        <!-- Sistema de tabs -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab-btn active" data-tab="ventas">Ventas</button>
                <button class="tab-btn" data-tab="apartado-tienda">Apartado en Tienda</button>
                <button class="tab-btn" data-tab="apartado-linea">Apartado en Línea</button>
            </div>
        </div>

        <!-- Contenido de los tabs -->
        <div class="tab-content">
            <!-- Tab de Ventas (contenido original) -->
            <div class="tab-pane active" id="ventas">
                <div class="ventas-panel">
                    <div class="busqueda-panel">
                        <h2><i class="fas fa-cash-register"></i> Punto de Venta</h2>

                        <div class="search-box">
                            <input type="text" id="busqueda-producto"
                                placeholder="Buscar producto por nombre o código...">
                            <div id="sugerencias-container" class="sugerencias-container"></div>
                        </div>

                        <div class="carrito-panel">
                            <h3><i class="fas fa-shopping-cart"></i> Productos en venta</h3>

                            <div class="carrito-lista" id="carrito-lista">
                                <div class="carrito-vacio">
                                    <i class="fas fa-shopping-basket"></i>
                                    <p>No hay productos agregados</p>
                                </div>
                            </div>

                            <div class="carrito-totales">
                                <div class="total-line">
                                    <span>Subtotal:</span>
                                    <span id="subtotal">$0.00</span>
                                </div>
                                <div class="total-line total-final">
                                    <span>TOTAL:</span>
                                    <span id="total">$0.00</span>
                                </div>
                            </div>

                            <div class="carrito-acciones">
                                <button id="btn-pagar" class="btn-primary">
                                    <i class="fas fa-money-bill-wave"></i> Pagar
                                </button>
                                <button id="btn-cancelar" class="btn-secondary">
                                    <i class="fas fa-times"></i> Cancelar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Preview del ticket -->
                    <div class="ticket-preview-panel">
                        <h3><i class="fas fa-receipt"></i> Vista Previa del Ticket</h3>
                        <div class="ticket-container" id="ticket-preview">
                            <div class="ticket">
                                <div class="ticket-header">
                                    <h1>Toy Garaje</h1>
                                    <p>Tienda de Coleccionables</p>
                                    <p>Calle Circuito, Jdn. 14C, Alamos 3ra Secc, 76147</p>
                                    <p>Tel: (+52)446-145-1938</p>
                                    <div class="ticket-divider"></div>
                                    <p class="ticket-info">
                                        <span id="ticket-numero">Ticket #: 00000000</span>
                                        <span id="ticket-fecha">Fecha: 00/00/0000</span>
                                    </p>
                                    <p class="ticket-info">
                                        <span id="ticket-hora">Hora: 00:00:00</span>
                                        <span id="ticket-cajero">Cajero: Usuario</span>
                                    </p>
                                    <div class="ticket-divider"></div>
                                </div>

                                <div class="ticket-content">
                                    <table class="ticket-items">
                                        <thead>
                                            <tr>
                                                <th class="item-qty">Cant</th>
                                                <th class="item-name">Descripción</th>
                                                <th class="item-price">Precio</th>
                                                <th class="item-total">Total</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ticket-items-body">
                                            <tr class="empty-ticket">
                                                <td colspan="4" class="empty-message">Agregue productos a la venta</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div class="ticket-divider"></div>
                                </div>

                                <div class="ticket-footer">
                                    <div class="ticket-totals">
                                        <div class="total-line">
                                            <span class="total-label">Subtotal:</span>
                                            <span class="total-value" id="ticket-subtotal">$0.00</span>
                                        </div>
                                        <div class="total-line" id="ticket-descuento-row" style="display: none;">
                                            <span class="total-label">Descuento:</span>
                                            <span class="total-value" id="ticket-descuento">$0.00</span>
                                        </div>
                                        <div class="total-line total-final">
                                            <span class="total-label">TOTAL:</span>
                                            <span class="total-value" id="ticket-total">$0.00</span>
                                        </div>
                                    </div>

                                    <div class="ticket-divider"></div>

                                    <div class="payment-info">
                                        <p><strong>Forma de pago:</strong> <span id="ticket-forma-pago">Efectivo</span>
                                        </p>
                                        <p id="ticket-recibido-container"><strong>Recibido:</strong> <span
                                                id="ticket-recibido">$0.00</span></p>
                                        <p id="ticket-cambio-container"><strong>Cambio:</strong> <span
                                                id="ticket-cambio">$0.00</span></p>
                                    </div>

                                    <div class="ticket-divider"></div>

                                    <!-- CÓDIGO DE BARRAS DINÁMICO -->
                                    <div class="ticket-barcode" id="ticket-barcode">
                                        <!-- Esta imagen se actualiza en el script -->
                                        <img id="ticket-barcode-img" src="https://barcodeapi.org/api/code128/00000000"
                                            alt="Código de barras"
                                            style="width: 100%; max-width: 180px; height: 40px; display: block; margin: auto;" />
                                        <p class="barcode-text" style="font-family: 'Courier New', monospace; letter-spacing: 2px;"
                                            id="ticket-barcode-text">*00000000*
                                        </p>
                                    </div>

                                    <div class="ticket-footer-msg">
                                        <p>¡Gracias por su compra!</p>
                                        <p>Vuelva pronto</p>
                                        <p class="small-text">Este ticket es su comprobante de compra</p>
                                        <p class="small-text">www.toygaraje.com</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab de Apartado en Tienda -->
            <div class="tab-pane" id="apartado-tienda">
                <div class="apartado-container">
                    <h2><i class="fas fa-store"></i> Apartado en Tienda</h2>

                    <div class="apartado-info-card">
                        <h3>¿Cómo funciona el apartado en tienda?</h3>
                        <div class="proceso-apartado">
                            <div class="paso-apartado">
                                <div class="paso-numero">1</div>
                                <div class="paso-contenido">
                                    <h4>Selecciona tus productos</h4>
                                    <p>Visita cualquiera de nuestras tiendas físicas y selecciona los productos que
                                        deseas apartar.</p>
                                </div>
                            </div>
                            <div class="paso-apartado">
                                <div class="paso-numero">2</div>
                                <div class="paso-contenido">
                                    <h4>Realiza un anticipo</h4>
                                    <p>Paga un anticipo mínimo del 30% del valor total de tu compra para asegurar tus
                                        productos.</p>
                                </div>
                            </div>
                            <div class="paso-apartado">
                                <div class="paso-numero">3</div>
                                <div class="paso-contenido">
                                    <h4>Completa tu pago</h4>
                                    <p>Tienes hasta 15 días para completar el pago y recoger tus productos en la tienda.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="apartado-info-card">
                        <h3>Políticas de apartado en tienda</h3>
                        <ul class="politicas-lista">
                            <li><i class="fas fa-check-circle"></i> El anticipo mínimo es del 30% del valor total de la
                                compra.</li>
                            <li><i class="fas fa-check-circle"></i> El período máximo de apartado es de 15 días
                                naturales.</li>
                            <li><i class="fas fa-check-circle"></i> Si no completas tu pago en el período establecido,
                                perderás tu anticipo.</li>
                            <li><i class="fas fa-check-circle"></i> Los productos apartados no pueden ser cambiados por
                                otros artículos.</li>
                            <li><i class="fas fa-check-circle"></i> Puedes realizar pagos parciales durante el período
                                de apartado.</li>
                        </ul>
                    </div>

                    <div class="apartado-info-card">
                        <h3>Nuestras tiendas</h3>
                        <div class="tiendas-grid">
                            <div class="tienda-card">
                                <h4>Toy Garage - Centro</h4>
                                <p><i class="fas fa-map-marker-alt"></i> Av. Constituyentes 123, Centro, 76000</p>
                                <p><i class="fas fa-phone"></i> (442) 123-4567</p>
                                <p><i class="fas fa-clock"></i> Lun-Sáb: 10:00 - 20:00, Dom: 11:00 - 18:00</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab de Apartado en Línea -->
            <div class="tab-pane" id="apartado-linea">
                <div class="apartado-container">
                    <h2><i class="fas fa-globe"></i> Apartado en Línea</h2>

                    <!-- Formulario de búsqueda de token -->
                    <div class="apartado-info-card">
                        <h3>Consultar Apartado Existente</h3>
                        <div class="token-search-container">
                            <form id="form-buscar-token" class="form-token">
                                <div class="form-group">
                                    <label for="token-apartado">Ingresa el código de tu apartado:</label>
                                    <div class="token-input-group">
                                        <input type="text" id="token-apartado" placeholder="Ej: AP-12345" required>
                                        <button type="submit" class="btn-primary">
                                            <i class="fas fa-search"></i> Buscar
                                        </button>
                                    </div>
                                    <p class="form-hint">Ingresa el código que recibiste al realizar tu apartado.</p>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Resumen de apartado (inicialmente oculto) -->
                    <div id="resumen-apartado" class="apartado-info-card" style="display: none;">
                        <h3>Resumen de tu Apartado</h3>
                        <div class="apartado-details">
                            <div class="apartado-header">
                                <div>
                                    <p><strong>Código de Apartado:</strong> <span id="codigo-apartado">AP-12345</span>
                                    </p>
                                    <p><strong>Fecha de Apartado:</strong> <span id="fecha-apartado">01/01/2025</span>
                                    </p>
                                    <p><strong>Estado:</strong> <span id="estado-apartado"
                                            class="badge badge-pending">Pendiente</span></p>
                                </div>
                                <div>
                                    <p><strong>Cliente:</strong> <span id="cliente-apartado">Nombre del Cliente</span>
                                    </p>
                                    <p><strong>Método de Entrega:</strong> <span id="metodo-entrega-apartado">Recoger en
                                            tienda</span></p>
                                    <p><strong>Fecha Límite:</strong> <span id="fecha-limite">15/01/2025</span></p>
                                </div>
                            </div>

                            <div class="apartado-productos">
                                <h4>Productos Apartados</h4>
                                <div class="tabla-container">
                                    <table class="tabla-productos">
                                        <thead>
                                            <tr>
                                                <th>Producto</th>
                                                <th>Cantidad</th>
                                                <th>Precio Unitario</th>
                                                <th>Subtotal</th>
                                            </tr>
                                        </thead>
                                        <tbody id="productos-apartados">
                                            <!-- Los productos se cargarán dinámicamente -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div class="apartado-totales">
                                <div class="total-line">
                                    <span>Subtotal:</span>
                                    <span id="apartado-subtotal">$0.00</span>
                                </div>
                                <div class="total-line total-final">
                                    <span>TOTAL:</span>
                                    <span id="apartado-total">$0.00</span>
                                </div>
                            </div>

                            <div class="apartado-acciones">
                                <div class="search-box apartado-search-box">
                                    <input type="text" id="busqueda-producto-boleto"
                                        placeholder="Buscar producto por nombre o código...">
                                    <div id="sugerencias-container-boleto" class="sugerencias-container"></div>
                                </div>
                                <button id="btn-agregar-producto-boleto" class="btn-secondary">
                                    <i class="fas fa-plus"></i> Agregar
                                </button>
                                <button id="btn-completar-compra" class="btn-primary">
                                    <i class="fas fa-check-circle"></i> Completar Compra
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="ticket-preview-apartado" class="apartado-info-card" style="display: none;">
                        <h3><i class="fas fa-receipt"></i> Vista Previa del Ticket</h3>
                        <div class="ticket-container">
                            <div class="ticket">
                                <!-- Encabezado del ticket -->
                                <div class="ticket-header">
                                    <h1>Toy Garaje</h1>
                                    <p>Tienda de Coleccionables</p>
                                    <p>Calle Circuito, Jdn. 14C, Alamos 3ra Secc, 76147</p>
                                    <p>Tel: (+52)446-145-1938</p>
                                    <div class="ticket-divider"></div>
                                    <p class="ticket-info">
                                        <span id="ticket-numero-apartado">Apartado #: 00000000</span>
                                        <span id="ticket-fecha-apartado">Fecha: 00/00/0000</span>
                                    </p>
                                    <p class="ticket-info">
                                        <span id="ticket-hora-apartado">Hora: 00:00:00</span>
                                        <span id="ticket-cajero-apartado">Cajero: Usuario</span>
                                    </p>
                                    <div class="ticket-divider"></div>
                                </div>

                                <!-- Contenido del ticket (productos) -->
                                <div class="ticket-content">
                                    <table class="ticket-items">
                                        <thead>
                                            <tr>
                                                <th class="item-qty">Cant</th>
                                                <th class="item-name">Descripción</th>
                                                <th class="item-price">Precio</th>
                                                <th class="item-total">Total</th>
                                            </tr>
                                        </thead>
                                        <tbody id="ticket-items-body-apartado">
                                            <tr class="empty-ticket">
                                                <td colspan="4" class="empty-message">Agregue productos al apartado</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div class="ticket-divider"></div>
                                </div>

                                <!-- Pie del ticket (totales) -->
                                <div class="ticket-footer">
                                    <div class="ticket-totals">
                                        <div class="total-line">
                                            <span class="total-label">Subtotal:</span>
                                            <span class="total-value" id="ticket-subtotal-apartado">$0.00</span>
                                        </div>
                                        <div class="total-line total-final">
                                            <span class="total-label">TOTAL:</span>
                                            <span class="total-value" id="ticket-total-apartado">$0.00</span>
                                        </div>
                                    </div>

                                    <div class="ticket-divider"></div>

                                    <div class="payment-info">
                                        <p><strong>Cliente:</strong> <span id="ticket-cliente-apartado">Cliente</span>
                                        </p>
                                        <p><strong>Método de entrega:</strong> <span
                                                id="ticket-entrega-apartado">Recoger en tienda</span></p>
                                    </div>

                                    <div class="ticket-divider"></div>
                                    <div class="ticket-barcode">
                                        <div class="barcode-placeholder"></div>
                                        <p class="barcode-text" id="ticket-barcode-text-apartado">*00000000*</p>
                                    </div>

                                    <div class="ticket-footer-msg">
                                        <p>¡Gracias por tu apartado!</p>
                                        <p>Te esperamos pronto</p>
                                        <p class="small-text">Este ticket es tu comprobante de apartado</p>
                                        <p class="small-text">www.toygaraje.com</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal de pago -->
    <div id="modal-pago" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Finalizar Venta</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="forma-pago">
                    <h4>Forma de pago</h4>
                    <select id="metodo-pago">
                        <option value="Efectivo">Efectivo</option>
                        <option value="Tarjeta">Tarjeta</option>
                        <option value="Transferencia">Transferencia</option>
                    </select>

                    <div class="input-group">
                        <label for="descuento-input">Descuento (%):</label>
                        <input type="number" id="descuento-input" min="0" max="100" step="1" value="15">
                    </div>

                    <!-- Total con descuento -->
                    <div class="total-con-descuento">
                        <p>Total con descuento: <strong id="total-con-descuento">$0.00</strong></p>
                    </div>

                    <div id="efectivo-container">
                        <div class="input-group">
                            <label for="efectivo-recibido">Efectivo recibido:</label>
                            <input type="number" id="efectivo-recibido" min="0" step="0.01">
                        </div>
                        <div class="input-group cambio-container">
                            <label for="cambio">Cambio a entregar:</label>
                            <input type="text" id="cambio" readonly>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-confirmar-pago" class="btn-primary">Confirmar Pago</button>
                <button id="btn-cancelar-pago" class="btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="modal-overlay"></div>

    <!-- Modal para completar compra de apartado -->
    <div id="modal-completar-compra" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Completar Compra</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="resumen-final">
                    <div class="total-line">
                        <span>Subtotal:</span>
                        <span id="modal-subtotal">$0.00</span>
                    </div>
                    <div class="total-line descuento-line">
                        <span>Descuento:</span>
                        <span id="modal-descuento">$0.00 (0%)</span>
                    </div>
                    <div class="total-line total-final">
                        <span>Total a pagar:</span>
                        <span id="modal-total">$0.00</span>
                    </div>
                </div>

                <div class="forma-pago">
                    <h4>Forma de pago</h4>
                    <select id="metodo-pago-apartado">
                        <option value="Efectivo">Efectivo</option>
                        <option value="Tarjeta de Crédito">Tarjeta de Crédito</option>
                        <option value="Tarjeta de Débito">Tarjeta de Débito</option>
                        <option value="Transferencia">Transferencia</option>
                    </select>

                    <div id="efectivo-container-apartado">
                        <div class="input-group">
                            <label for="efectivo-recibido-apartado">Efectivo recibido:</label>
                            <input type="number" id="efectivo-recibido-apartado" min="0" step="0.01">
                        </div>
                        <div class="input-group">
                            <label for="cambio-apartado">Cambio:</label>
                            <input type="text" id="cambio-apartado" readonly>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-confirmar-compra" class="btn-primary">Confirmar Pago</button>
                <button id="btn-cancelar-compra" class="btn-secondary">Cancelar</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/ventas.js"></script>
</body>

</html>